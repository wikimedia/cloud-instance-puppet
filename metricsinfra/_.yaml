apereo_cas:
  production:
    login_url: https://idp.wmcloud.org/login
    validate_url: https://idp.wmcloud.org/serviceValidate
profile::wmcs::metricsinfra::alertmanager_active_host: metricsinfra-alertmanager-1.metricsinfra.eqiad1.wikimedia.cloud
profile::wmcs::metricsinfra::config_manager_hosts:
- metricsinfra-controller-1.metricsinfra.eqiad1.wikimedia.cloud
profile::wmcs::metricsinfra::global_alert_groups:
- name: wmcs_instance
  rules:
  - alert: InstanceDown
    annotations:
      summary: Project {{ $labels.project }} instance {{ $labels.instance }} is down
    expr: up{job="node"} == 0
    for: 5m
    labels:
      severity: warn
  - alert: WidespreadInstanceDown
    annotations:
      summary: Widespread instances down in project {{ $labels.project }}
    expr: count by (project) (up{job="node"} == 0) / count by (project) (up{job="node"})
      * 100 >= 15
    for: 5m
    labels:
      severity: crit
- name: wmcs_puppet
  rules:
  - alert: PuppetAgentFailures
    annotations:
      summary: Puppet agent failure detected on instance {{ $labels.instance }} in
        project {{ $labels.project }}
    expr: puppet_agent_failed != 0
    for: 15m
    labels:
      severity: warn
  - alert: WidespreadPuppetAgentFailures
    annotations:
      summary: Widespread puppet agent failures in project {{ $labels.project }}
    expr: sum by (project) (puppet_agent_failed) / count by (project) (puppet_agent_failed)
      * 100 >= 15
    for: 15m
    labels:
      severity: crit
  - alert: PuppetAgentDisabled
    annotations:
      summary: Puppet agent disabled on instance {{ $labels.instance }} in project
        {{ $labels.project }}
    expr: puppet_agent_enabled != 1
    for: 15m
    labels:
      severity: warn
  - alert: PuppetmasterUpdateFailures
    annotations:
      summary: Failed to update Puppet repository {{ $labels.repository }} on instance
        {{ $labels.instance }} in project {{ $labels.project }}
    expr: puppet_sync_upstream_rebase_success != 1
    for: 15m
    labels:
      severity: warn
profile::wmcs::metricsinfra::global_jobs:
- name: node
  openstack_discovery:
    port: 9100
profile::wmcs::metricsinfra::monitored_projects:
- name: metricsinfra
  notify_email:
  - hi@taavi.wtf
profile::wmcs::metricsinfra::prometheus::ext_fqdn: prometheus.wmflabs.org
profile::wmcs::metricsinfra::prometheus_alertmanager_hosts:
- metricsinfra-alertmanager-1.metricsinfra.eqiad1.wikimedia.cloud
profile::wmcs::metricsinfra::prometheus_hosts:
- prometheus01.metricsinfra.eqiad.wmflabs
puppetmaster: metricsinfra-puppetmaster-1.metricsinfra.eqiad1.wikimedia.cloud
